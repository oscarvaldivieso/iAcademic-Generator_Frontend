<section class="auth-page-wrapper">
  <div class="password-reset-container">
    
    <!-- Columna Izquierda: Branding e Imagen -->
    <div class="password-reset-left-panel">
      <div class="password-reset-brand">
        <img src="/assets/images/logo-ceutec-horizontal.png" alt="CEUTEC Logo" class="brand-logo" />
        <h1 class="brand-title">Restablecer Contraseña</h1>
        <p class="brand-subtitle">Recupera el acceso a tu cuenta</p>
      </div>
      
      <!-- Imagen ilustrativa -->
      <div class="brand-illustration">
        <img src="/assets/images/forgot-password.png" alt="Restablecer contraseña" class="illustration-image" />
      </div>

      
      <div class="login-section">
        <p class="login-text">¿Recordaste tu contraseña?</p>
        <a routerLink="/auth/login" class="login-link">
          <i class="ri-arrow-left-line"></i> Volver al inicio de sesión
        </a>
      </div>
      
    </div>

    <!-- Columna Derecha: Formulario -->
    <div class="password-reset-right-panel">
      <div class="password-reset-card">
        
        <!-- Paso 1: Solicitar email -->
        <div class="reset-step" *ngIf="currentStep === 'request'">
          <div class="step-header">
            <div class="step-icon">
              <i class="ri-mail-send-line"></i>
            </div>
            <h2 class="step-title">Ingresa tu correo electrónico</h2>
            <p class="step-description">
              Te enviaremos un código de verificación para restablecer tu contraseña
            </p>
          </div>

          <form [formGroup]="resetRequestForm" (ngSubmit)="onRequestSubmit()" class="reset-form">
            <div class="form-section">
              <div class="input-group">
                <label for="email" class="input-label">Correo electrónico *</label>
                <div class="input-wrapper">
                  <i class="ri-mail-line input-icon"></i>
                  <input 
                    type="email" 
                    formControlName="email" 
                    id="email" 
                    placeholder="correo@ceutec.edu.hn" 
                    class="glass-input"
                  />
                </div>
                <div class="input-hint">
                  Usa tu correo institucional o el correo alterno registrado
                </div>
              </div>
            </div>

            <div class="form-footer">
              <div class="btn-container">
                <button type="submit" class="btn-login" [disabled]="resetRequestForm.invalid || isLoading">
                  <span class="btn-text" *ngIf="!isLoading">Enviar código</span>
                  <span class="btn-text" *ngIf="isLoading">Enviando...</span>
                  <i class="ri-send-plane-line btn-icon" *ngIf="!isLoading"></i>
                  <i class="ri-loader-4-line btn-icon spinning" *ngIf="isLoading"></i>
                </button>
              </div>
            </div>
          </form>
        </div>

        <!-- Paso 2: Verificar código -->
        <div class="reset-step" *ngIf="currentStep === 'verify'">
          <div class="step-header">
            <div class="step-icon">
              <i class="ri-shield-check-line"></i>
            </div>
            <h2 class="step-title">Verifica tu código</h2>
            <p class="step-description">
              Ingresa el código de 6 dígitos que enviamos a <strong>{{ maskedEmail }}</strong>
            </p>
          </div>

          <form [formGroup]="verifyCodeForm" (ngSubmit)="onVerifySubmit()" class="reset-form">
            <div class="form-section">
              <div class="verification-code-group">
                <label class="input-label">Código de verificación *</label>
                <div class="code-inputs">
                  <input 
                    type="text" 
                    maxlength="1" 
                    class="code-input glass-input"
                    formControlName="digit1"
                    (input)="onCodeInput($event, 0)"
                    (keydown)="onCodeKeydown($event, 0)"
                  />
                  <input 
                    type="text" 
                    maxlength="1" 
                    class="code-input glass-input"
                    formControlName="digit2"
                    (input)="onCodeInput($event, 1)"
                    (keydown)="onCodeKeydown($event, 1)"
                  />
                  <input 
                    type="text" 
                    maxlength="1" 
                    class="code-input glass-input"
                    formControlName="digit3"
                    (input)="onCodeInput($event, 2)"
                    (keydown)="onCodeKeydown($event, 2)"
                  />
                  <input 
                    type="text" 
                    maxlength="1" 
                    class="code-input glass-input"
                    formControlName="digit4"
                    (input)="onCodeInput($event, 3)"
                    (keydown)="onCodeKeydown($event, 3)"
                  />
                  <input 
                    type="text" 
                    maxlength="1" 
                    class="code-input glass-input"
                    formControlName="digit5"
                    (input)="onCodeInput($event, 4)"
                    (keydown)="onCodeKeydown($event, 4)"
                  />
                  <input 
                    type="text" 
                    maxlength="1" 
                    class="code-input glass-input"
                    formControlName="digit6"
                    (input)="onCodeInput($event, 5)"
                    (keydown)="onCodeKeydown($event, 5)"
                  />
                </div>
              </div>

              <div class="resend-section">
                <p class="resend-text">¿No recibiste el código?</p>
                <button type="button" class="resend-link" (click)="resendCode()" [disabled]="resendCooldown > 0">
                  <span *ngIf="resendCooldown === 0">Reenviar código</span>
                  <span *ngIf="resendCooldown > 0">Reenviar en {{ resendCooldown }}s</span>
                </button>
              </div>
            </div>

            <div class="form-footer">
              <div class="btn-container">
                <button type="button" class="btn-login" (click)="goToStep('request')">
                  <i class="ri-arrow-left-line btn-icon"></i>
                  <span class="btn-text">Atrás</span>
                </button>
                <button type="submit" class="btn-login" [disabled]="verifyCodeForm.invalid || isLoading">
                  <span class="btn-text" *ngIf="!isLoading">Verificar</span>
                  <span class="btn-text" *ngIf="isLoading">Verificando...</span>
                  <i class="ri-check-line btn-icon" *ngIf="!isLoading"></i>
                  <i class="ri-loader-4-line btn-icon spinning" *ngIf="isLoading"></i>
                </button>
              </div>
            </div>
          </form>
        </div>

        <!-- Paso 3: Nueva contraseña -->
        <div class="reset-step" *ngIf="currentStep === 'reset'">
          <div class="step-header">
            <div class="step-icon">
              <i class="ri-lock-2-line"></i>
            </div>
            <h2 class="step-title">Nueva contraseña</h2>
            <p class="step-description">
              Crea una contraseña segura para tu cuenta
            </p>
          </div>

          <form [formGroup]="newPasswordForm" (ngSubmit)="onResetSubmit()" class="reset-form">
            <div class="form-section">
              <div class="input-group">
                <label for="newPassword" class="input-label">Nueva contraseña *</label>
                <div class="input-wrapper">
                  <i class="ri-lock-2-line input-icon"></i>
                  <input 
                    [type]="showNewPassword ? 'text' : 'password'" 
                    formControlName="newPassword" 
                    id="newPassword" 
                    placeholder="Mínimo 8 caracteres"
                    class="glass-input"
                  />
                  <button type="button" class="toggle-password" (click)="toggleNewPassword()">
                    <i class="ri-eye-line" *ngIf="!showNewPassword"></i>
                    <i class="ri-eye-off-line" *ngIf="showNewPassword"></i>
                  </button>
                </div>
              </div>

              <div class="input-group">
                <label for="confirmPassword" class="input-label">Confirmar contraseña *</label>
                <div class="input-wrapper">
                  <i class="ri-lock-2-line input-icon"></i>
                  <input 
                    [type]="showConfirmPassword ? 'text' : 'password'" 
                    formControlName="confirmPassword" 
                    id="confirmPassword" 
                    placeholder="Repetir contraseña"
                    class="glass-input"
                  />
                  <button type="button" class="toggle-password" (click)="toggleConfirmPassword()">
                    <i class="ri-eye-line" *ngIf="!showConfirmPassword"></i>
                    <i class="ri-eye-off-line" *ngIf="showConfirmPassword"></i>
                  </button>
                </div>
              </div>

              <!-- Indicador de fortaleza de contraseña -->
              <div class="password-strength" *ngIf="newPasswordForm.get('newPassword')?.value">
                <div class="strength-label">Fortaleza de la contraseña:</div>
                <div class="strength-bar">
                  <div class="strength-fill" [class]="getPasswordStrengthClass()"></div>
                </div>
                <div class="strength-text">{{ getPasswordStrengthText() }}</div>
              </div>

              <!-- Requisitos de contraseña -->
              <div class="password-requirements">
                <p class="requirements-title">La contraseña debe contener:</p>
                <div class="requirement-item" [class.met]="hasMinLength()">
                  <i class="ri-check-line" *ngIf="hasMinLength()"></i>
                  <i class="ri-close-line" *ngIf="!hasMinLength()"></i>
                  <span>Al menos 8 caracteres</span>
                </div>
                <div class="requirement-item" [class.met]="hasUppercase()">
                  <i class="ri-check-line" *ngIf="hasUppercase()"></i>
                  <i class="ri-close-line" *ngIf="!hasUppercase()"></i>
                  <span>Una letra mayúscula</span>
                </div>
                <div class="requirement-item" [class.met]="hasLowercase()">
                  <i class="ri-check-line" *ngIf="hasLowercase()"></i>
                  <i class="ri-close-line" *ngIf="!hasLowercase()"></i>
                  <span>Una letra minúscula</span>
                </div>
                <div class="requirement-item" [class.met]="hasNumber()">
                  <i class="ri-check-line" *ngIf="hasNumber()"></i>
                  <i class="ri-close-line" *ngIf="!hasNumber()"></i>
                  <span>Un número</span>
                </div>
              </div>
            </div>

            <div class="form-footer">
              <div class="btn-container">
                <button type="button" class="btn-secondary" (click)="goToStep('verify')">
                  <i class="ri-arrow-left-line btn-icon"></i>
                  <span class="btn-text">Atrás</span>
                </button>
                <button type="submit" class="btn-primary" [disabled]="newPasswordForm.invalid || isLoading">
                  <span class="btn-text" *ngIf="!isLoading">Restablecer</span>
                  <span class="btn-text" *ngIf="isLoading">Restableciendo...</span>
                  <i class="ri-refresh-line btn-icon" *ngIf="!isLoading"></i>
                  <i class="ri-loader-4-line btn-icon spinning" *ngIf="isLoading"></i>
                </button>
              </div>
            </div>
          </form>
        </div>

        <!-- Paso 4: Éxito -->
        <div class="reset-step" *ngIf="currentStep === 'success'">
          <div class="step-header success">
            <div class="step-icon success">
              <i class="ri-check-double-line"></i>
            </div>
            <h2 class="step-title">¡Contraseña restablecida!</h2>
            <p class="step-description">
              Tu contraseña ha sido actualizada exitosamente. Ya puedes iniciar sesión con tu nueva contraseña.
            </p>
          </div>

          <div class="form-footer">
            <div class="btn-container">
              <button type="button" class="btn-primary full-width" (click)="goToLogin()">
                <span class="btn-text">Iniciar sesión</span>
                <i class="ri-login-box-line btn-icon"></i>
              </button>
            </div>
          </div>
        </div>

      </div>
    </div>

  </div>
</section>